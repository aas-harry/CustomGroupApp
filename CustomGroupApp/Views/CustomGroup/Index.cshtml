<div class="container-fluid" style="margin: 20px">
    <h1>Create Custom Groups</h1>
    <div class="row">
        <button onClick="getResults()">Get Results</button>
        <button onClick="createMixClasses()">Create Mix</button>
        <button onClick="createStreamingClasses()">Create streaming</button>
        <button onClick="createBandingClasses()">Create Banding</button>
        <button onclick="createTopMidBottomClasses()">Create TMB</button>
        <div id="message-text"></div>
    </div>

    <div class="row" style="margin-bottom: 30px">
        <div class="col-md-4" id="jqgrid1-container">
            <table id="jqGrid1"></table>
        </div>
        <div class="col-md-4" id="jqgrid2-container">
            <table id="jqGrid2"></table>
        </div>
        <div class="col-md-4" id="jqgrid3-container">
            <table id="jqGrid3"></table>
        </div>
    </div>

    <div class="row" style="margin-bottom: 30px">
        <div class="col-md-4" id="jqgrid4-container">
            <table id="jqGrid4"></table>
        </div>
        <div class="col-md-4" id="jqgrid5-container">
            <table id="jqGrid5"></table>
        </div>
        <div class="col-md-4" id="jqgrid6-container">
            <table id="jqGrid6"></table>
        </div>
    </div>
    <div class="row" style="margin-bottom: 30px">
        <div class="col-md-4" id="summary-container">
            <table id="summary-grid"></table>
        </div>
    </div>
</div>
<script>
    var testFile = new TestFile();
    var data1 = [];
    var data2 = [];
    var data3 = [];
    var data4 = [];
    var data5 = [];
    var data6 = [];
    $(document)
        .ready(function() {

        });

    function getResults() {
        $.ajax({
            url: '@Url.Action("GetResults", "CustomGroup")',
            data: { testnum: 1014405 },
            type: 'POST',
            cache: false,
            success: function(data) {
                testFile.clear();
                testFile.fileNumber = data.Test.Testnum;
                testFile.grade = data.Test.Grade;
                testFile.category = data.Test.Category;
                testFile.testDate = data.Test.Testdate;
                testFile.setStudents(data.Results);

                $("#message-text").replaceWith("Test file with " + data.Results.length);
            },
            fail: function(data) {

            }
        });
    }

    function createMixClasses() {
        var classesDefn = new ClassesDefinition(testFile);
        var bandSet = classesDefn.createBandSet("class", classesDefn.studentCount, 1,
             BandStreamType.Streaming, BandType.None, StreamType.OverallAbilty, GroupingMethod.MixedAbility);
        
        var band = bandSet.bands[0];
        band.setClassCount(5);
        //band.classes[0].count += 5;
        //band.classes[1].count -= 3;
        //band.classes[2].count -= 2;

        bandSet.prepare("Mix", classesDefn.students);

        for (var i = 1; i <= band.classes.length; i++) {

            $("#jqGrid" + i)
                .jqGrid({
                    datatype: "local",
                    data: band.classes[i - 1].students,
                    height: 350,
                    colModel: [
                        { label: 'Name', name: 'name', width: 150 },
                        { label: 'Sex', name: 'gender', width: 50 },
                        { label: 'Score', name: 'score', width: 80 },
                        { label: 'Class', name: 'classNo', width: 80 }
                    ],
                    viewrecords: true, // show the current page, data rang and total records on the toolbar
                    caption: "Mixability Group " + i
                });
        }
        for (var j = band.classes.length + 1; j <= 6; j++) {

            $("#jqGrid" + j).replaceWith("");
        }

        band.calculateClassesAverage(band.classes);

        $("#summary-grid")
            .jqGrid({
                datatype: "local",
                data: band.classes,
                colModel: [
                    { label: 'Class', name: 'index', width: 150 },
                    { label: 'Average', name: 'average', width: 50 }
                ],
                viewrecords: true, // show the current page, data rang and total records on the toolbar
                caption: "Group Summary"
            });
    }

    function createStreamingClasses() {
        var classesDefn = new ClassesDefinition(testFile);
        var bandSet = classesDefn.createBandSet("class", classesDefn.studentCount, 1, 
            BandStreamType.Streaming, BandType.None, StreamType.OverallAbilty, GroupingMethod.Streaming);
        var band = bandSet.bands[0];
        band.streamType = StreamType.OverallAbilty;
        
        bandSet.prepare("Maths", classesDefn.students);

        band.setClassCount(5);
        band.classes[0].count += 5;
        band.classes[1].count -= 3;
        band.classes[2].count -= 2;

        bandSet.prepare(classesDefn.students);
        var classes = band.classes;
        
        for (var i = 1; i <= classes.length; i++) {

            $("#jqGrid" + i)
                .jqGrid({
                    datatype: "local",
                    data: classes[i - 1].students,
                    height: 350,
                    colModel: [
                        { label: 'Name', name: 'name', width: 150 },
                        { label: 'Sex', name: 'gender', width: 50 },
                        { label: 'Score', name: 'score', width: 80 },
                        { label: 'Class', name: 'classNo', width: 80 }
                    ],
                    viewrecords: true, // show the current page, data rang and total records on the toolbar
                    caption: "Streaming Group " + i
                });
        }
        for (var j = classes.length + 1; j <= 6; j++) {

            $("#jqGrid" + j).replaceWith("");
        }

        band.calculateClassesAverage(classes);

        $("#summary-grid")
            .jqGrid({
                datatype: "local",
                data: band.classes,
                colModel: [
                    { label: 'Class', name: 'index', width: 150 },
                    { label: 'Count', name: 'count', width: 50 },
                { label: 'Average', name: 'average', width: 50 }
                ],
                viewrecords: true, // show the current page, data rang and total records on the toolbar
                caption: "Group Summary"
            });
    }

    function createBandingClasses() {
        var classes = new ClassesDefinition(testFile);
        // Create two bands
        var bandSet = classes.createBandSet("band", classes.studentCount, 2, BandType.Custom,
             BandStreamType.Streaming, StreamType.OverallAbilty, GroupingMethod.MixedAbility);
        bandSet.bands[0].setClassCount(3);
        bandSet.bands[1].setClassCount(3);
        bandSet.prepare(classes.students);
        var tmpClasses = [];
        tmpClasses = bandSet.bands[0].classes.concat(bandSet.bands[1].classes);
        for (var i = 1; i <= tmpClasses.length; i++) {

            $("#jqGrid" + i)
                .jqGrid({
                    datatype: "local",
                    data: tmpClasses[i-1].students,
                    height: 350,
                    colModel: [
                        { label: 'Name', name: 'name', width: 150 },
                        { label: 'Sex', name: 'gender', width: 50 },
                        { label: 'Score', name: 'score', width: 80 },
                        { label: 'Class', name: 'classNo', width: 80 }
                    ],
                    viewrecords: true, // show the current page, data rang and total records on the toolbar
                    caption: "Group " + i + " of " + tmpClasses[i-1].parent.bandNo
                });
        }

        //for (var j = classes.singleBand.classes.length + 1; j <= 6; j++) {
        //    $("#jqGrid" + j).replaceWith("");
        //}

        bandSet.bands[0].calculateClassesAverage(tmpClasses);

        $("#summary-grid")
            .jqGrid({
                datatype: "local",
                data: tmpClasses,
                colModel: [
                    { label: 'Class', name: 'index', width: 150 },
                    { label: 'Average', name: 'average', width: 50 }
                ],
                viewrecords: true, // show the current page, data rang and total records on the toolbar
                caption: "Group Summary"
            });
    }

    function createTopMidBottomClasses() {
        debugger;
        var classes = new ClassesDefinition(testFile);
        var bandSet = classes.createTopMiddleBottomBandSet("abc");
        bandSet.bands[0].setClassCount(2);
        bandSet.bands[1].setClassCount(2);
        bandSet.bands[2].setClassCount(2);
        bandSet.createBandClasses(BandStreamType.Streaming, false);
        var tmpClasses = [];
        tmpClasses = bandSet.bands[0].classes.concat(bandSet.bands[1].classes)
        .concat(bandSet.bands[2].classes);
        for (var i = 1; i <= tmpClasses.length; i++) {

            $("#jqGrid" + i)
                .jqGrid({
                    datatype: "local",
                    data: tmpClasses[i - 1].students,
                    height: 350,
                    colModel: [
                        { label: 'Name', name: 'name', width: 150 },
                        { label: 'Sex', name: 'gender', width: 50 },
                        { label: 'Score', name: 'score', width: 80 },
                        { label: 'Class', name: 'classNo', width: 80 }
                    ],
                    viewrecords: true, // show the current page, data rang and total records on the toolbar
                    caption: "Group " + i + " of " + tmpClasses[i - 1].parent.bandNo
                });
        }

        //for (var j = classes.singleBand.classes.length + 1; j <= 6; j++) {
        //    $("#jqGrid" + j).replaceWith("");
        //}

        classes.singleBand.calculateClassesAverage(tmpClasses);

        $("#summary-grid")
            .jqGrid({
                datatype: "local",
                data: tmpClasses,
                colModel: [
                    { label: 'Class', name: 'index', width: 150 },
                    { label: 'Average', name: 'average', width: 50 }
                ],
                viewrecords: true, // show the current page, data rang and total records on the toolbar
                caption: "Group Summary"
            });
    }
</script>